Cleaning up

 * Function passed directly into event handler
 * Function definition moved to be before use
